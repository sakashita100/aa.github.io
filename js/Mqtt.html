<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MQTT Browser Subscriber</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
    <h1>MQTT Web Subscriber</h1>
    <div id="messages"></div>

    <script>
        const host = {
            protocol: 'wss',
            hostname: 'broker.hivemq.com',
            port: 8000,
            path: '/mqtt'
        };
        const client = mqtt.connect(host);

        client.on('connect', function () {
            console.log('Connected to MQTT broker via WebSocket');
            document.getElementById('messages').innerHTML += '<p>Connected to MQTT broker</p>';

            const topic = 'sensor/data';
            client.subscribe(topic, function (err) {
                if (!err) {
                    document.getElementById('messages').innerHTML += '<p>Subscribed to ' + topic + '</p>';
                } else {
                    console.error('Subscribe error: ', err);
                    document.getElementById('messages').innerHTML += '<p>Error subscribing to topic: ' + err + '</p>';
                }
            });
        });

        client.on('message', function (topic, message) {
            console.log('Received message: ' + message.toString() + ' on topic ' + topic);
            document.getElementById('messages').innerHTML += '<p>Message on ' + topic + ': ' + message.toString() + '</p>';
        });

        client.on('error', function (err) {
            console.error('Connection error: ', err);
            document.getElementById('messages').innerHTML += '<p>Error: ' + err + '</p>';
        });

        client.on('close', function () {
            console.log('Connection closed');
            document.getElementById('messages').innerHTML += '<p>Connection closed</p>';
        });
    </script>
</body>
</html>
